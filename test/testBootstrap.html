<!-- The order of loading is important here.
The test frameworks must be loaded before requirejs.-->
<script src="../bower_components/platform/platform.js" type="text/javascript"></script>

<link rel="stylesheet" href="../node_modules/mocha/mocha.css" />
<script src="../node_modules/mocha/mocha.js" type="text/javascript"></script>
<script src="../node_modules/chai/chai.js" type="text/javascript"></script>
<script src="../utils/sinon.js" type="text/javascript"></script>
<script src="../utils/lodash.min.js" type="text/javascript"></script>

<!-- Set up our test environment -->
<script src="./htmlTest.js"></script>

<script src="../utils/require.min.js" type="text/javascript"></script>
<script>
  require.config({
    baseUrl: "../"
  });

  window.assert = chai.assert;
  window.expect = chai.expect;

  mocha.setup('bdd');

  // running as part of karma? make sure failures result in true failures
  // that the htmlTest.js will pick up
  if (window.top !== window) {
    mocha.setup({
      reporter: function(runner) {
        runner.on('fail', function(a,b,c) {
          console.log('fail');
          setTimeout(function() {
            throw b;
          },0);
        });
        runner.on('end', function(x) {
          console.log('end');
          done();
        });
      }
    });
  }

  function pageLoaded() {
    whenReady().then(mocha.run)
      // .then(done)
      .catch(function(e) {
        setTimeout(function() {
          throw e;
        },0);
      });
  }

  document.addEventListener("DOMContentLoaded", pageLoaded, false);

</script>
